{% extends "layout.html" %}
{% block css %}
	<link rel="stylesheet" href="/css/finance.css" type="text/css" media="screen" charset="utf-8">
	<!--	<link rel="stylesheet" href="/css/styles.css" type="text/css" media="screen" charset="utf-8"> -->
{% endblock %}

{% block scripts %}
	<!--[if IE]><script language="javascript" type="text/javascript" src="/js/flotr/excanvas.js"></script><![endif]-->
	<script language="javascript" type="text/javascript" src="/js/prototype.js"></script>
	<script language="javascript" type="text/javascript" src="/js/scriptaculous.js"></script>
	<script language="javascript" type="text/javascript" src="/js/flotr/base64.js"></script>
	<script language="javascript" type="text/javascript" src="/js/flotr/canvas2image.js"></script>
	<script language="javascript" type="text/javascript" src="/js/flotr/canvastext.js"></script>
	<script language="javascript" type="text/javascript" src="/js/flotr/flotr.js"></script>
	<script language="javascript" type="text/javascript"  src="/js/effects.js"></script> 
	<script language="javascript" type="text/javascript"  src="/js/dragdrop.js"></script> 
	<script language="javascript" type="text/javascript"  src="/js/controls.js"></script> 
	<script language="javascript" type="text/javascript"  src="/js/builder.js"></script>
	<script type="text/javascript" src="/js/humble/HumbleFinance.js"></script>
	<script type="text/javascript" src="/js/charting.js"></script>
	<script type="text/javascript" >
		js = {{ result|safe }};
		document.observe("dom:loaded", function() {
			priceData = [];
			volumeData = [];
			summaryData = [];
			jsonData = [];
			bgData = [];
			flagData = [];

			openData = [];
			closeData = [];
			highData = [];
			lowData = [];
			if(js){
				chartData(js.contents.data);
			}
			var mydrag = new Draggable('querybank', { revert: true });

			Event.observe('queryform', 'submit', function(event) {
				priceData = [];
				volumeData = [];
				summaryData = [];
				jsonData = [];
				bgData = [];
				flagData = [];

				openData = [];
				closeData = [];
				highData = [];
				lowData = [];
				
				$('finance').update("<div id=\"labels\"><div id=\"dateRange\">&nbsp;</div></div>");
				
				$('queryform').request({
					onFailure: function(t) {
					  alert("fail");
					},
					onSuccess: function(t) {
					  delete rdata;
					  
					  eval("rdata = "+t.responseText);
					  //$('jsondiv').update(rdata);
					  chartData(rdata["contents"]["data"]);
					}
				});
				Event.stop(event); // stop the form from submitting
			});

		});
	</script>
{% endblock %}

{% block content %}
	<div class="left_main grid_9">
		<div class="query_section">
			<h2>Query</h2>
			<form id="queryform" action="/query/" method="get">
				<div class="query_input">
					<input name="symbol" id="symbol" type="text" value="{{params.symbol}}"/>
					<input name="start_date" id="start_date" type="text" value="{{params.start_date}}"/>
					<input name="end_date" id="end_date" type="text" value="{{params.end_date}}"/>
				</div>
				<textarea name="query" class="query_area">{{params.query}}</textarea>
				<input type="submit" value="Go!"/>
			</form>
			<div class="spacer"></div>
		</div>
		<div id="graphcontainer">
			<div id="finance">
				<div id="labels">
					<div id="dateRange">&nbsp;</div>
				</div>
			</div>
		</div>
	</div> <!-- close left main -->
	<div class="right_sidebar grid_3">
		<div class="bull_queries">
			<h2>Bull</h2>
			<ul id="querybank" class="query_bank">
				<li>macd(17,8) gradient >= 0</li>
				<li>macd(17,8) gradient >= 0</li>
				<li>macd(17,8) gradient >= 0</li>
			</ul>	
		</div>
		<div class="bear_queries">
			<h2>Bear</h2>			
			<ul class="query_bank">
				<li>macd(17,8) gradient >= 0</li>
				<li>macd(17,8) gradient >= 0</li>
				<li>macd(17,8) gradient >= 0</li>
			</ul>	
		</div>
	</div>
{% endblock %}
